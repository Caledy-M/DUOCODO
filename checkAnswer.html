<html>
    <head>
        <script src="./skulpt/skulpt.min.js" type="text/javascript"></script> 
        <script src="./skulpt/skulpt-stdlib.js" type="text/javascript"></script> 
        <script src="./interpreter.js" type="text/javascript"></script>
        <meta charset="UTF-8">
    </head>
    <body>
        <script type="text/javascript">

const QandA = 
    {
      id: 0,
      type: 'open',
      question: 'Entrez la fonction qui permet d\'afficher dans la console: ',
      //reponse: 'print',
      renduconsole: 'Hello World',
      //variables[]
      // phrase complète print("Hello World")
      remaining: ['',
        '("Hello World")'],
    };


function checkAnswer(level, playerInput, out_consoleOutput=null, errorCallback=null) // out_consoleOutput won’t work, gonna have to fill the HTML directly here
{
    //const playerInput = document.querySelector("#input").value;
    console.log("Entering checkAnswer");
    console.log(level);
    if (level.type == "open")
    {
        console.log("Type=open");
        // Assemble the code to send to the interpreter
        var skulptInput = ""
        for (i=0; i<level.remaining.length; i++)
        {
            if (level.remaining[i] == "")
                skulptInput += playerInput;
            else
                skulptInput += level.remaining[i];
        }

        let variablesValues = null;
        if (level.variables != null)
            variablesValues = JSON.parse(JSON.stringify(level.variables));

        out_consoleOutput = skulpt(skulptInput, variablesValues, errorCallback);
        console.log(out_consoleOutput);


        // Check if the result is what we expect
        if (level.reponse != null)
        {
            if (playerInput != level.reponse) {
                console.log("Player input isn’t what was expected");
                return false;
            }
        }
        if (level.renduconsole != null)
        {
            if (out_consoleOutput != level.renduconsole) {
                console.log("Console output isn’t what we expected");
                return false;
            }
        }
        if (level.variables != null)
        {
            console.log("Warning: Variables check hasn’t been tested yet");
            for (i=0; i<variables.length; i++)
            {
                if(variablesValues[i].value != level.variables[i].value) {
                    console.log("Variable " + level.variablesValues[i].name + " isn’t what we expected");
                    return false;
                }       
            }
        }
        return true;
    }
    else
    {
        console.error("checkAnswer() not yet implemented for types other than ’open’");
    }   
}

/// DEBUG

var playerAnswer = "print(\"Hello\")\nprint";
console.log(checkAnswer(QandA, playerAnswer));


//////////


</script>
    </body>
</html>